# Joely 数独 · 玩法扩展需求文档（PRD/需求草案）

更新时间：2026-01-04

## 1. 背景与目标
当前项目为“传统数独 + 计时/提示/错误上限/排行榜（本地）/主题切换”。目标是在不显著增加学习成本的前提下，引入更“新奇”的可玩点，提升：
- 复玩率：每天/每局都有继续玩的理由
- 竞技性：更公平、更可比的成绩体系
- 体验差异：同样是数独，但玩法呈现更有记忆点

### 1.1 非目标（暂不做）
- 复杂变体的完整生成与求解（如完整 Killer / Thermo / Arrow 等需要新求解器）
- 线上账户系统、云同步、多端数据
- 多页复杂运营系统（活动页、商城等）

## 2. 术语
- **经典数独**：9×9，行/列/宫 1-9 不重复
- **提示（Hint）**：自动填入一个正确数字（或提供强提示）
- **失误（Mistake）**：填入与解不一致的数字；可能触发红色标注与错误计数
- **Daily（每日挑战）**：同一日期固定同一盘，便于对比成绩
- **No-notes（无候选）**：禁止使用候选笔记/记号
- **Fog（迷雾）**：只突出显示与当前焦点相关区域，其余淡化

## 3. 现状与约束（对齐实现成本）
- Vue 3 + TS + Vite；daisyUI 主题通过 `data-theme` 切换
- 已存在：计时、提示次数、错误次数/上限、撤销、同数字高亮、存档（localStorage）
- 排行榜目前为本地数据结构（按难度存 best times）

## 4. 功能清单（按优先级）
本 PRD 覆盖 8 个可选功能，建议按里程碑逐步实现：

P0（低风险高收益，优先）
1) 每日挑战（Daily）
2) 计分模式（Score Run）
3) 迷雾数独（Fog of War）

P1（中等改动）
4) 无候选挑战（No-notes）
5) 成就/任务（Achievements）

P2（可玩性强，但需要更多设计/验证）
6) 轻量“锁链/钥匙”（Killer-lite 约束提示）
7) 道具/事件卡（轻 roguelike）

P3（大改动，后置）
8) 变体规则（X/Hyper 等）

---

## 5. 详细需求

### 5.1 每日挑战（Daily）【P0】
**一句话**：每天固定一盘，成绩可比。

#### 5.1.1 用户故事
- 作为玩家，我想每天打开都有一盘固定题目，方便养成习惯
- 作为竞速玩家，我想跟朋友比同一盘的用时/分数

#### 5.1.2 规则
- 同一天（按本地日期 `YYYY-MM-DD`）同难度生成同一盘
- 同一天重复进入应加载同一盘（可继续/重开当日盘）

#### 5.1.3 入口与交互（最小）
- 首页新增按钮（或一个入口）：每日挑战
- 进入后显示：日期、难度、模式标识（Daily）

#### 5.1.4 数据
- 存档需要包含：`mode: 'daily'`、`dateKey`、`difficulty`
- 排行榜：建议新增 daily 专用榜（按 dateKey + difficulty），或在现有结构里扩展

#### 5.1.5 验收
- 同一天刷新/重进，题面一致
- 跨天后进入，题面变化

---

### 5.2 计分模式（Score Run）【P0】
**一句话**：把“好不好”从单纯计时扩展为“综合表现”。

#### 5.2.1 用户故事
- 我希望更快且更少失误/更少提示能得到更高分

#### 5.2.2 计分建议（可调参）
- 基础分：按完成给固定基础分（随难度递增）
- 时间惩罚：每秒扣分或按用时区间扣分
- 提示惩罚：每次提示扣分
- 错误惩罚：每次错误扣分（或断连击）
- 连击：连续正确填入加成（可选）

> 备注：最终公式实现前可先落“版本 v1”公式，后续再调。

#### 5.2.3 UI
- 顶部信息区展示：Score（实时）
- 结算展示：分数构成（可简化为：基础/时间/提示/错误）

#### 5.2.4 数据
- 存档：记录当前分数与（可选）连击状态
- 排行榜：新增 score 榜（尤其对 Daily 非常适合）

#### 5.2.5 验收
- 同一盘不同表现得分不同，提示/错误会导致分数降低

---

### 5.3 迷雾数独（Fog of War）【P0】
**一句话**：不改规则，改“可见性”，体验立刻变新。

#### 5.3.1 用户故事
- 我想要一种更沉浸/更烧脑的视觉玩法

#### 5.3.2 规则
- 只突出：选中格 + 同行列 + 同宫（以及可选：同数字）
- 其他格：降低透明度（或轻度模糊）；仍允许点击切换焦点

#### 5.3.3 UI/交互
- 游戏页增加开关：Fog（开启/关闭）
- 开启后：非相关格淡化

#### 5.3.4 技术实现提示（非强制）
- 复用现有“关联格高亮”判断，补一个 `isFogDimmed` 类

#### 5.3.5 验收
- 开启 Fog 后，页面只突出相关区域；关闭后恢复当前样式

---

### 5.4 无候选挑战（No-notes）【P1】
**一句话**：限制工具，让玩法更刺激。

#### 5.4.1 前置说明
当前项目未实现“候选/笔记”功能；该模式可作为未来候选功能的“限制开关”。

#### 5.4.2 规则
- 若未来加入候选：No-notes 模式下禁用候选输入
- 若当前无候选：该模式可以先作为“限制提示/撤销”等工具的替代（可选）

#### 5.4.3 验收
- No-notes 开启时，候选入口不可用（或不可见）

---

### 5.5 成就/任务（Achievements）【P1】
**一句话**：给玩家长期目标，不用改核心玩法。

#### 5.5.1 示例成就
- 0 错误通关
- 0 提示通关
- 5 分钟内通关（easy）
- 连续 7 天游玩 Daily

#### 5.5.2 UI
- 首页或排行榜页加一个“成就”入口（也可以先用简单列表）
- 通关弹出（或页面内展示）解锁提示（可选）

#### 5.5.3 数据
- localStorage：`achievements` 记录解锁时间与进度

#### 5.5.4 验收
- 满足条件即解锁并持久化

---

### 5.6 Killer-lite（锁链/钥匙）【P2】
**一句话**：做轻量“额外约束提示”，不做完整 Killer 求解器。

#### 5.6.1 规则（建议 v1）
- 选取若干组 cage（2~4 个格）
- cage 内数字不重复
- 显示 cage 总和（来自 solution 计算）

#### 5.6.2 UI
- cage 边界用细线或角标提示
- cage 左上角显示 sum

#### 5.6.3 风险
- 生成 cage 的质量会影响体验（太难/太鸡肋）
- 需要调参：cage 数量、大小分布

#### 5.6.4 验收
- cage 显示正确，总和与最终解一致

---

### 5.7 道具/事件卡（轻 roguelike）【P2】
**一句话**：每局随机给技能，让每局体验不同。

#### 5.7.1 示例道具
- 透视一行：临时高亮该行正确数字位置（不直接填数）
- 纠错券：下一次错误不计入错误次数
- 预判：下一次输入会提示是否正确（不扣错，但可能扣分）

#### 5.7.2 UI
- 游戏页按钮区增加“道具栏”（最多 1~3 个）

#### 5.7.3 数据
- 存档需记录：道具列表与使用状态

#### 5.7.4 验收
- 每局随机给定道具；使用后效果正确生效并持久化

---

### 5.8 变体规则（X/Hyper 等）【P3】
**一句话**：真正改变规则，但实现成本高。

#### 5.8.1 选项
- X-Sudoku：两条对角线也必须 1-9 不重复
- Hyper：额外 4 个 3×3 宫区域

#### 5.8.2 风险
- 需要更新：生成器/求解器/冲突检测/提示逻辑

#### 5.8.3 验收
- 规则约束正确；生成的题有唯一解（或明确策略）

---

## 6. 配置与模式矩阵（建议）
- `mode`: `classic | daily | score | fog | ...`（可组合或互斥）
- 难度：`easy | medium | hard`

建议组合策略：
- Daily 可叠加 Score（强推荐）
- Fog 可作为单独开关（可叠加 Classic/Daily）

## 7. 数据与兼容性
- 所有新字段保持“向后兼容”：旧存档缺字段时使用默认值
- localStorage key 建议分层：
  - save（当前局）
  - leaderboard（各模式）
  - achievements（长期）

## 8. 里程碑（建议实施顺序）
1) M1：Daily（生成/存档/入口）
2) M2：Score（计分公式 v1 + 展示 + 榜单）
3) M3：Fog（开关 + 样式实现）
4) M4：Achievements（基础成就 + 解锁）
5) M5：Killer-lite 或 道具系统（二选一）
6) M6：变体规则（X/Hyper）

## 9. 验收清单（总）
- 不破坏现有 Classic 玩法
- 任何模式切换都有明确入口与状态展示
- 存档/继续游戏在各模式下行为一致且可预期
- 同一 Daily 题目在同一天稳定复现
- Score 的扣分项与 UI 展示一致
- Fog 开关不影响输入与选择逻辑
